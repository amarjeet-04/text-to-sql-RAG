1. supplier level sql:
with AM as(select distinct employeeid,suppliername from [MIS_Report_Data].[dbo].[suppliermaster_Report] with (nolock))
,
main as(
select distinct BD.supplierid,AM.employeeid,AM.suppliername,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
left join AM
on AM.employeeid = BD.supplierid
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
group by BD.supplierid,AM.employeeid,AM.suppliername,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date))
select * from main


2. Agent type level sql:
with AM as(SELECT distinct agentid,agentname,agenttype from [MIS_Report_Data].[dbo].AgentTypeMapping),
AMV as (select distinct AgentId,AgentCode,AgentName from [MIS_Report_Data].[dbo].[AgentMaster_V1]),
ag_type as(
select distinct
case when AMV.agentcode = 'WEGR' then 'We Groups' else
AM.agenttype end as agenttype,
count(distinct pnrno) total_bookings
from dbo.BookingData BD with (nolock)
left join AM on AM.agentid = BD.agentid
left join AMV on AMV.agentid = BD.agentid
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
group by AMV.agentcode, AM.agenttype
)
select distinct agenttype, sum(total_bookings) as total_bookings
from ag_type
group by agenttype

 
3. country level sql:
with AM as(select distinct CountryID,Country from [MIS_Report_Data].[dbo].[Master_Country] with (nolock))
,
main as(
select distinct BD.ProductCountryid,AM.CountryID,AM.Country,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
left join AM
on AM.CountryID = BD.ProductCountryid
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
group by BD.ProductCountryid,AM.CountryID,AM.Country,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date))
select * from main


4. city level sql:
 
with AM as(select distinct [CityId],City from [MIS_Report_Data].[dbo].[Master_City] with (nolock))
,
main as(
select distinct BD.[ProductCityId],AM.CityID,AM.City,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
left join AM
on AM.[CityId] = BD.[ProductCityId]
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
group by BD.[ProductCityId],AM.[CityId],AM.City,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date))
select * from main


5. client nationality level:
select distinct BD.ClientNatinality,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
--and ClientNatinality = 'united states'
--and cast(createddate as date) = '2026-01-03'
group by BD.ClientNatinality,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date)

6. hotel level sql:
 
select distinct BD.productname,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
--and productname = 'indonesia'
--and cast(createddate as date) = '2026-01-03'
group by BD.productname,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date)

8. hotel sales growth YTD vs PYTD sql:
with main as (
select distinct productname,
SUM(CASE
    WHEN cast(CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()), 1, 1)
     AND cast(CreatedDate as date) <= GETDATE()
     and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN agentbuyingprice
END) AS YTD_Sales,
SUM(CASE
    WHEN cast(CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()) - 1, 1, 1)
     AND cast(CreatedDate as date) <= DATEADD(YEAR, -1, GETDATE())
     and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN agentbuyingprice
END) AS PYTD_Sales
from dbo.BookingData BD with (nolock)
where CreatedDate >= DATEFROMPARTS(YEAR(GETDATE())-1,1,1)
  AND CreatedDate < DATEFROMPARTS(YEAR(GETDATE())+1,1,1)
group by productname
)
SELECT TOP 15
    productname,
    YTD_Sales,
    PYTD_Sales,
    (YTD_Sales - PYTD_Sales) AS Growth_Amount,
    CASE
        WHEN YTD_Sales = 0 THEN NULL
        ELSE (YTD_Sales - PYTD_Sales) * 100.0 / NULLIF(PYTD_Sales, 0)
    END AS Growth_Percentage
FROM main
WHERE YTD_Sales IS NOT NULL
ORDER BY Growth_Percentage DESC


9. supplier sales growth YTD vs PYTD sql:
with AM as (select distinct employeeid, suppliername from [MIS_Report_Data].[dbo].[suppliermaster_Report] with (nolock)),
main as (
select distinct AM.suppliername,
SUM(CASE
    WHEN cast(BD.CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()), 1, 1)
     AND cast(BD.CreatedDate as date) <= GETDATE()
     and BD.bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN BD.agentbuyingprice
END) AS YTD_Sales,
SUM(CASE
    WHEN cast(BD.CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()) - 1, 1, 1)
     AND cast(BD.CreatedDate as date) <= DATEADD(YEAR, -1, GETDATE())
     and BD.bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN BD.agentbuyingprice
END) AS PYTD_Sales
from dbo.BookingData BD with (nolock)
left join AM on AM.employeeid = BD.supplierid
where BD.CreatedDate >= DATEFROMPARTS(YEAR(GETDATE())-1,1,1)
  AND BD.CreatedDate < DATEFROMPARTS(YEAR(GETDATE())+1,1,1)
group by AM.suppliername
)
SELECT TOP 15
    suppliername,
    YTD_Sales,
    PYTD_Sales,
    (YTD_Sales - PYTD_Sales) AS Growth_Amount,
    CASE
        WHEN YTD_Sales = 0 THEN NULL
        ELSE (YTD_Sales - PYTD_Sales) * 100.0 / NULLIF(PYTD_Sales, 0)
    END AS Growth_Percentage
FROM main
WHERE YTD_Sales IS NOT NULL
ORDER BY Growth_Percentage DESC


10. country sales growth YTD vs PYTD sql:
with AM as (select distinct CountryID, Country from [MIS_Report_Data].[dbo].[Master_Country] with (nolock)),
main as (
select distinct AM.Country,
SUM(CASE
    WHEN cast(BD.CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()), 1, 1)
     AND cast(BD.CreatedDate as date) <= GETDATE()
     and BD.bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN BD.agentbuyingprice
END) AS YTD_Sales,
SUM(CASE
    WHEN cast(BD.CreatedDate as date) >= DATEFROMPARTS(YEAR(GETDATE()) - 1, 1, 1)
     AND cast(BD.CreatedDate as date) <= DATEADD(YEAR, -1, GETDATE())
     and BD.bookingstatus not in ('Cancelled','Not Confirmed','On Request')
    THEN BD.agentbuyingprice
END) AS PYTD_Sales
from dbo.BookingData BD with (nolock)
left join AM on AM.CountryID = BD.ProductCountryid
where BD.CreatedDate >= DATEFROMPARTS(YEAR(GETDATE())-1,1,1)
  AND BD.CreatedDate < DATEFROMPARTS(YEAR(GETDATE())+1,1,1)
group by AM.Country
)
SELECT TOP 15
    Country,
    YTD_Sales,
    PYTD_Sales,
    (YTD_Sales - PYTD_Sales) AS Growth_Amount,
    CASE
        WHEN YTD_Sales = 0 THEN NULL
        ELSE (YTD_Sales - PYTD_Sales) * 100.0 / NULLIF(PYTD_Sales, 0)
    END AS Growth_Percentage
FROM main
WHERE YTD_Sales IS NOT NULL
ORDER BY Growth_Percentage DESC


7. hotel chain level sql:
with AM as(select  
distinct hotelid,hotelname,country,city,star,chain
from [MIS_Report_Data].[dbo].[Hotelchain])
,
main as(
select distinct BD.[ProductId],AM.hotelid,AM.hotelname,
case when AM.chain is null then 'No Chain Hotels'
when chain = 'COURTYARD BY MARRIOTT'
or chain = 'Marriott - Renaissance Hotels'
or chain = 'Marriott'
or chain = 'Marriott International'
then 'Marriot Group'
when chain = 'Hyatt Hotels Corporation' or chain = 'Hyatt Hotels'
then 'Hyatt Group'
when chain = 'Accor - Thalassa' or chain = 'Novotel Accor Hotels'
or chain = 'Accor'
then 'Accor Group'
when chain = 'Best Western Hotels' or chain = 'Best Western Hotels & Resorts'
or chain = 'Best Western'
then 'Best Western Group'
when chain = 'Kempinski Hotels & Resorts' or chain = 'Kempinski'
then 'Kempinski Group'
when chain = 'Four Seasons' or chain = 'Four Seasons Real Estate'
or chain = 'Four Seasons Hotels and Resorts'
then 'Four Seasons Group'
when chain = 'Shangri-La Hotels and Resorts' or chain = 'Shangri-La Hotels - Traders Hotels'
then 'Shangri-La Group'
else AM.chain end as chain,
cast(createddate as date) as booking_date,cast(checkindate as date) as checkin_date,cast(checkoutdate as date) as checkout_date,sum(agentbuyingprice) as total_sales,sum(agentbuyingprice - companybuyingprice) as total_profit
,count(distinct pnrno) as total_booking
from dbo.BookingData BD with (nolock)
left join AM
on AM.hotelid = BD.[ProductId]
where cast(CreatedDate as date) >= '2025-01-01 00:00:00.000'
and bookingstatus not in ('Cancelled','Not Confirmed','On Request')
group by BD.[ProductId],AM.hotelid,AM.hotelname,AM.chain,
cast(createddate as date),cast(checkindate as date) ,cast(checkoutdate as date))
select * from main
--where booking_date = '2026-01-03'
--and chain = 'Independent'